---
/**
 * Date Picker By Giri Diwa Adam
 *
 */
---

<!-- Pastikan ini dijalankan di komponen Astro yang di-render di client -->
<div class="w-full">
    <!-- Datepicker wrapper -->
    <div
      x-data="{
        show:false,
        selected: null,
        display: '',
        viewMonth: (new Date()).getMonth(),
        viewYear: (new Date()).getFullYear(),
        weekdays: ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'],

        // helper: jumlah hari di bulan view
        daysInMonth(month, year){
          return new Date(year, month+1, 0).getDate();
        },

        // helper: index hari pertama (0=Sun)
        firstDayIndex(month, year){
          return new Date(year, month, 1).getDay();
        },

        // pindah bulan
        prevMonth(){
          if(this.viewMonth === 0){
            this.viewMonth = 11;
            this.viewYear--;
          } else this.viewMonth--;
        },
        nextMonth(){
          if(this.viewMonth === 11){
            this.viewMonth = 0;
            this.viewYear++;
          } else this.viewMonth++;
        },

        // pilih tanggal
        pick(day){
          const d = new Date(this.viewYear, this.viewMonth, day);
          this.selected = d;
          this.display = this.format(d);
          this.show = false;
        },

        // format tanggal: YYYY-MM-DD (ubah sesuai kebutuhan)
        format(d){
          const y = d.getFullYear();
          const m = String(d.getMonth()+1).padStart(2,'0');
          const day = String(d.getDate()).padStart(2,'0');
          return `${y}-${m}-${day}`;
        },

        // generate grid untuk tampilan bulan
        monthGrid(){
          const total = this.daysInMonth(this.viewMonth, this.viewYear);
          const firstIdx = this.firstDayIndex(this.viewMonth, this.viewYear);
          const cells = [];
          // previous month's tail (optional)
          const prevMonth = this.viewMonth === 0 ? 11 : this.viewMonth - 1;
          const prevYear = this.viewMonth === 0 ? this.viewYear - 1 : this.viewYear;
          const prevTotal = this.daysInMonth(prevMonth, prevYear);

          for(let i = 0; i < firstIdx; i++){
            cells.push({day: prevTotal - firstIdx + 1 + i, dim:true});
          }
          for(let d = 1; d <= total; d++){
            cells.push({day: d, dim:false});
          }
          // pad to full weeks
          while(cells.length % 7 !== 0) cells.push({day: (cells.length - firstIdx - total + 1), dim:true});
          return cells;
        }
      }"
      class="relative"
      x-init="$watch('selected', v => { /* hook jika perlu */ })"
    >
      <!-- Input -->
      <p class="block text-sm text-slate-700 mb-1">Pilih tanggal</p>
      <div class="relative">
        <input
          type="text"
          readonly
          x-model="display"
          @click="show = !show"
          @keydown.escape="show = false"
          placeholder="YYYY-MM-DD"
          class="w-full px-3 py-2 rounded-lg border text-black border-slate-300 bg-white focus:outline-none focus:ring-2 focus:ring-indigo-300 cursor-pointer placeholder:text-black dark:placeholder:text-black"
        />
        <button
          @click="selected = null; display=''; show = false"
          title="Clear"
          class="absolute right-2 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-700"
          x-show="display"
        >
          âœ•
        </button>
      </div>

      <!-- Calendar dropdown -->
      <div
        x-show="show"
        x-transition
        @click.away="show = false"
        class="mt-2 bg-white rounded-xl shadow-lg p-4 w-80 z-50 relative"
        style="min-width: 20rem;"
      >
        <!-- Header: month / year -->
        <div class="flex items-center justify-between mb-3">
          <div class="flex items-center gap-3">
            <button @click="prevMonth" type="button" class="p-1 rounded hover:bg-slate-100 dark:text-black">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
            </button>

            <div class="text-center">
              <div class="font-semibold dark:text-black" x-text="new Date(viewYear, viewMonth).toLocaleString('default',{ month: 'long' }) + ' ' + viewYear"></div>
            </div>

            <button @click="nextMonth" type="button" class="p-1 rounded hover:bg-slate-100">
              <svg class="w-5 h-5 dark:text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
            </button>
          </div>

          <!-- Jump to today -->
          <div>
            <button @click="viewMonth=(new Date()).getMonth(); viewYear=(new Date()).getFullYear();" class="text-xs px-2 py-1 rounded-md bg-slate-100 hover:bg-slate-200 dark:bg-black">Today</button>
          </div>
        </div>

        <!-- Weekdays -->
        <div>
            <div class="grid grid-cols-7 gap-1 text-center text-xs text-slate-500 mb-2 place-items-center">
              <template x-for="d in weekdays" :key="d">
                <div x-text="d"></div>
              </template>
            </div>
        </div>

        <!-- Days -->
        <div class="grid grid-cols-7 gap-1">
          <template x-for="(cell, idx) in monthGrid()" :key="idx">
            <button
              type="button"
              class="h-10 flex items-center justify-center rounded hover:bg-indigo-50 focus:outline-none"
              x-bind:class="{
                'text-slate-400': cell.dim,
                'bg-indigo-600 text-white': (!cell.dim) && selected && selected.getFullYear() === viewYear && selected.getMonth() === viewMonth && selected.getDate() === cell.day,
                'border border-slate-100': !cell.dim && !(selected && selected.getFullYear() === viewYear && selected.getMonth() === viewMonth && selected.getDate() === cell.day)
              }"
              @click="if(!cell.dim) pick(cell.day)"
              @keydown.enter.prevent="if(!cell.dim) pick(cell.day)"
            >
              <span x-text="cell.day" class="text-slate-700"></span>
            </button>
          </template>
        </div>

        <!-- Footer - quick actions -->
        <div class="mt-3 flex items-center justify-between">
          <div class="text-sm text-slate-600">
            <span x-text="selected ? ('Selected: ' + display) : 'No date selected'"></span>
          </div>
          <div class="flex gap-2">
            <button @click="selected = new Date(viewYear, viewMonth, 1); display = format(selected); show=false" class="px-3 py-1 text-sm rounded bg-slate-100 hover:bg-slate-200 dark:bg-black">Pick 1st</button>
            <button @click="show = false" class="px-3 py-1 text-sm rounded bg-white border hover:bg-slate-50 dark:text-black cursor-pointer">Close</button>
          </div>
        </div>
      </div>
    </div>
  </div>

